<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Public Chat</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body { font-family: Arial; margin: 0; padding: 0; background:#101015; color:white; }
#chat, #admin { display:none; padding:20px; }
input, button { padding:10px; margin:5px; border-radius:5px; }
#messages { background:#181a20; padding:10px; height:300px; overflow-y:auto; border:1px solid #555; }
.log-row { font-size:12px; border-bottom:1px solid #333; padding:4px 0; }
a { color:#4da3ff; cursor:pointer; }
</style>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
</head>

<body>

<div style="padding:10px;background:#1e1e2e;display:flex;justify-content:space-between;">
<b>üåê Public Chat</b>
<a onclick="showAdminLogin()">Admin</a>
</div>

<div id="chat">
<h2>Public Chat</h2>
<div>
<input id="name" placeholder="Naam">
</div>
<div id="messages"></div>
<input id="msg" placeholder="Typ bericht...">
<button onclick="sendMsg()">Verstuur</button>
</div>

<div id="adminLogin" style="display:none;padding:20px;">
<h2>Admin Login</h2>
<input id="adminPass" type="password" placeholder="Wachtwoord">
<button onclick="adminAuth()">Login</button>
</div>

<div id="admin">
<h2>Admin Paneel</h2>
<button onclick="downloadLogs()">Download logs</button>
<div id="logs"></div>
</div>

<script>
// ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
// ‚úÖ FIREBASE INITIALIZATIE
// ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî

const firebaseConfig = {
  // TODO: VUL HIER JOUW FIREBASE CONFIG IN
  apiKey: "...",
  authDomain: "...",
  databaseURL: "https://zever-7eca0-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "zever-7eca0",
  storageBucket: "...",
  messagingSenderId: "...",
  appId: "P..."
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();


// ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
// ‚úÖ SIMULATED "IP" (veilig, geen privacy schending)
// ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
let fakeIP = localStorage.getItem("fakeIP");
if (!fakeIP) {
    fakeIP = "User-" + Math.floor(Math.random()*999999);
    localStorage.setItem("fakeIP", fakeIP);
}

// ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
// ‚úÖ USER VISIT LOG
// ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
const visit = {
    user: fakeIP,
    time: new Date().toLocaleString(),
    agent: navigator.userAgent
};
db.ref("logs").push(visit);

// ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
// ‚úÖ CHAT SYSTEM
// ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
function sendMsg(){
    const name = document.getElementById("name").value;
    const msg = document.getElementById("msg").value;
    if(!name || !msg) return;

    db.ref("messages").push({
        name, msg, time: new Date().toLocaleTimeString()
    });

    document.getElementById("msg").value = "";
}

db.ref("messages").on("child_added", snap=>{
    const d = snap.val();
    document.getElementById("messages").innerHTML +=
        `<div><b>${d.name}:</b> ${d.msg} <span style="opacity:.5;font-size:10px;">(${d.time})</span></div>`;
});

// ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
// ‚úÖ ADMIN PANEL
// ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
function showAdminLogin() {
    document.getElementById("adminLogin").style.display = "block";
}

function adminAuth(){
    const pass = document.getElementById("adminPass").value;
    if(pass === "admin123"){   // change this later!
        document.getElementById("adminLogin").style.display="none";
        document.getElementById("admin").style.display="block";
        loadLogs();
    } else {
        alert("Fout wachtwoord");
    }
}

function loadLogs(){
    db.ref("logs").once("value", snap=>{
        let html = "";
        snap.forEach(x=>{
            const d = x.val();
            html += `<div class="log-row">üë§ ${d.user} ‚Äî ${d.time}<br><span style="opacity:.5;">${d.agent}</span></div>`;
        });
        document.getElementById("logs").innerHTML = html;
    });
}

function downloadLogs(){
    db.ref("logs").once("value", snap=>{
        const data = JSON.stringify(snap.val(),null,2);
        const blob = new Blob([data], {type:"application/json"});
        const a = document.createElement("a");
        a.href = URL.createObjectURL(blob);
        a.download = "logs.json";
        a.click();
    });
}

// show chat by default
document.getElementById("chat").style.display="block";
</script>
</body>
</html>
