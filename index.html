<!doctype html>
<html lang="nl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Zever - Demo site</title>
<style>
  body{font-family:Arial,Helvetica,sans-serif;background:#f6f9f4;margin:0;}
  header{background:#0b6; padding:14px;color:#041;font-weight:700;text-align:center}
  main{padding:18px;max-width:1000px;margin:18px auto}
  .btn{display:inline-block;background:#0b6;color:white;padding:10px 14px;border-radius:6px;text-decoration:none;margin:6px}
  .muted{color:#444}
  .layout{display:flex;gap:16px;flex-wrap:wrap}
  .card{background:white;border-radius:8px;padding:12px;box-shadow:0 2px 6px rgba(0,0,0,0.08);flex:1 1 300px}
  #adminPanel{display:none}
  table{width:100%;border-collapse:collapse}
  th,td{padding:6px;border-bottom:1px solid #eee;font-size:13px}
  #cookieModal{position:fixed;left:0;right:0;bottom:10px;margin:auto;background:#fffbe6;padding:14px;border-radius:8px;box-shadow:0 6px 20px rgba(0,0,0,0.12);width:calc(100% - 40px);max-width:800px}
  #overlay{position:fixed;inset:0;background:rgba(0,0,0,0.35);display:none}
  .danger{background:#d9534f}
  input,button{font-family:inherit}
  .small{font-size:13px;color:#666}
  pre{white-space:pre-wrap;background:#f3f3f3;padding:8px;border-radius:6px;overflow:auto}
</style>
</head>
<body>

<header>Zever — Demo (single-file site)</header>

<main>
  <div class="layout">
    <div class="card">
      <h2>Welkom</h2>
      <p class="muted">Deze pagina demonstreert simpele login, visitor logging en webcam-toegang.
         Lees de waarschuwing en gebruik verantwoord.</p>

      <div style="margin-top:12px">
        <button id="loginBtn" class="btn">Login (owner)</button>
        <button id="viewBtn" class="btn" disabled>Open camera (vereist cookie)</button>
        <button id="showLogsBtn" class="btn" style="display:none">Admin: Bekijk logs</button>
        <button id="downloadBtn" class="btn" style="display:none">Admin: Download logs</button>
      </div>

      <hr/>

      <div id="cameraArea" style="margin-top:12px"></div>
    </div>

    <div class="card" id="siteInfo">
      <h3>Site status</h3>
      <p class="small">Cookie toegestaan: <span id="cookieState">nee</span></p>
      <p class="small">Laatste bezoeker IP: <span id="lastIP">-</span></p>
      <p class="small">Logs lokaal opgeslagen: <span id="logCount">0</span></p>
      <hr/>
      <p class="small">Note: camera toegang vraagt altijd toestemming aan de gebruiker.</p>
    </div>
  </div>

  <div id="adminPanel" class="card" style="margin-top:14px">
    <h3>Admin panel — bezoekers logs</h3>
    <p class="small">Alleen zichtbaar als je als owner bent ingelogd.</p>
    <div style="margin-top:8px;overflow:auto;max-height:360px;">
      <table id="logTable"><thead><tr><th>Tijd</th><th>IP</th><th>UserAgent</th><th>Screen</th><th>Info</th></tr></thead><tbody></tbody></table>
    </div>
  </div>
</main>

<!-- cookie consent modal -->
<div id="overlay"></div>
<div id="cookieModal" aria-hidden="true" style="display:none">
  <p><strong>Cookies & toestemming</strong></p>
  <p class="small">Wij vragen je toestemming voor cookies en (optioneel) camera-toegang. 
    Accepteer om door te gaan. Deze demo logt IP & device info voor de eigenaar.</p>
  <div style="margin-top:8px">
    <button id="acceptCookies" class="btn">Accepteer cookies</button>
    <button id="declineCookies" class="btn danger">Weiger</button>
  </div>
</div>

<script>
/*
  SINGLE-FILE SITE - Visitor logging + simple admin + camera toggle
  IMPORTANT:
  - Configure WEBHOOK_URL if you want logs sent to a remote collector (optional)
  - Configure OWNER_USERNAME and OWNER_PASSWORD below (insecure, stored in client)
*/

const WEBHOOK_URL = ""; // optioneel: plak hier jouw webhook.site of andere endpoint om logs heen te sturen
const OWNER_USERNAME = "admin";      // verander dit naar jouw gewenste ownernaam
const OWNER_PASSWORD = "wachtwoord"; // verander dit naar jouw gewenste wachtwoord

// helper: local storage keys
const LS_COOKIE_KEY = "zever_cookie_ok";
const LS_LOGS_KEY = "zever_logs_v1";

// elements
const cookieModal = document.getElementById("cookieModal");
const overlay = document.getElementById("overlay");
const acceptBtn = document.getElementById("acceptCookies");
const declineBtn = document.getElementById("declineCookies");
const cookieStateEl = document.getElementById("cookieState");
const lastIPEl = document.getElementById("lastIP");
const logCountEl = document.getElementById("logCount");

const loginBtn = document.getElementById("loginBtn");
const viewBtn = document.getElementById("viewBtn");
const showLogsBtn = document.getElementById("showLogsBtn");
const adminPanel = document.getElementById("adminPanel");
const logTableBody = document.querySelector("#logTable tbody");
const downloadBtn = document.getElementById("downloadBtn");
const cameraArea = document.getElementById("cameraArea");

// state
let cookieOK = (localStorage.getItem(LS_COOKIE_KEY) === "1");
let logs = JSON.parse(localStorage.getItem(LS_LOGS_KEY) || "[]");
updateUI();

function updateUI(){
  cookieStateEl.textContent = cookieOK? "ja":"nee";
  logCountEl.textContent = logs.length;
  lastIPEl.textContent = logs.length? (logs[logs.length-1].ip || "-") : "-";
}

// show cookie modal if not accepted
function showCookieModal(){
  overlay.style.display = "block";
  cookieModal.style.display = "block";
}
function hideCookieModal(){
  overlay.style.display = "none";
  cookieModal.style.display = "none";
}

if(!cookieOK){
  showCookieModal();
} else {
  viewBtn.disabled = false;
  // if cookie ok, automatically log this visit
  recordVisit();
}

// handlers
acceptBtn.addEventListener("click", ()=>{
  localStorage.setItem(LS_COOKIE_KEY,"1");
  cookieOK = true;
  updateUI();
  hideCookieModal();
  viewBtn.disabled = false;
  recordVisit();
});
declineBtn.addEventListener("click", ()=>{
  localStorage.setItem(LS_COOKIE_KEY,"0");
  cookieOK = false;
  updateUI();
  hideCookieModal();
  viewBtn.disabled = true;
});

// login (very simple)
loginBtn.addEventListener("click", ()=>{
  const user = prompt("Username:");
  if(user===null) return;
  const pass = prompt("Password:");
  if(pass===null) return;
  if(user === OWNER_USERNAME && pass === OWNER_PASSWORD){
    alert("Succesvol ingelogd als owner");
    showAdmin();
  } else {
    alert("Verkeerde inloggegevens");
  }
});

function showAdmin(){
  adminPanel.style.display = "block";
  showLogsBtn.style.display = "inline-block";
  downloadBtn.style.display = "inline-block";
  populateLogTable();
}

// populate table from local logs
function populateLogTable(){
  logTableBody.innerHTML = "";
  logs.slice().reverse().forEach(entry=>{
    const tr=document.createElement("tr");
    tr.innerHTML = "<td>"+escapeHtml(entry.time)+"</td>"
                 + "<td>"+escapeHtml(entry.ip || '-')+"</td>"
                 + "<td><small>"+escapeHtml(entry.ua)+"</small></td>"
                 + "<td>"+escapeHtml(entry.screen)+"</td>"
                 + "<td><small>"+escapeHtml(JSON.stringify(entry.extra||{}))+"</small></td>";
    logTableBody.appendChild(tr);
  });
}

// download logs
downloadBtn.addEventListener("click", ()=>{
  const dataStr = "data:application/json;charset=utf-8," + encodeURIComponent(JSON.stringify(logs, null, 2));
  const a = document.createElement("a");
  a.href = dataStr;
  a.download = "visitor_logs.json";
  a.click();
});

// camera logic
let stream = null;
viewBtn.addEventListener("click", async ()=>{
  if(!cookieOK){
    alert("Je moet cookies accepteren voordat je de camera kan gebruiken.");
    showCookieModal();
    return;
  }
  if(stream){
    // stop
    stream.getTracks().forEach(t=>t.stop());
    stream = null;
    cameraArea.innerHTML = "";
    viewBtn.textContent = "Open camera (vereist cookie)";
    return;
  }
  try{
    stream = await navigator.mediaDevices.getUserMedia({video:true,audio:false});
    const video = document.createElement("video");
    video.autoplay = true;
    video.playsInline = true;
    video.srcObject = stream;
    video.style.width = "100%";
    video.style.maxWidth = "480px";
    cameraArea.innerHTML = "";
    cameraArea.appendChild(video);
    viewBtn.textContent = "Stop camera";
  }catch(err){
    alert("Camera toegang mislukt of geweigerd: " + err.message);
  }
});

// record visit: gathers info and saves locally, optionally POSTs to WEBHOOK_URL
async function recordVisit(){
  if(!cookieOK) return;
  const entry = { time: new Date().toISOString(), ua: navigator.userAgent, screen: screen.width+"x"+screen.height, extra:{} };
  // try to fetch public IP from ipify
  try {
    const r = await fetch("https://api.ipify.org?format=json");
    if(r.ok){
      const j = await r.json();
      entry.ip = j.ip;
    }
  } catch(e) {
    entry.ip = "unknown";
  }
  // add more info
  entry.extra.platform = navigator.platform || "";
  entry.extra.lang = navigator.language || "";
  entry.extra.url = location.href;
  logs.push(entry);
  // keep logs reasonable size
  if(logs.length > 1000) logs = logs.slice(-1000);
  localStorage.setItem(LS_LOGS_KEY, JSON.stringify(logs));
  updateUI();
  // send to remote webhook if configured
  if(WEBHOOK_URL && WEBHOOK_URL.length>10){
    try {
      fetch(WEBHOOK_URL, {
        method: "POST",
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify(entry)
      });
    } catch(e){
      console.warn("Webhook POST failed", e);
    }
  }
}

// small helper for safety
function escapeHtml(s){ if(!s) return ""; return s.toString().replace(/[&<>"']/g, function(m){return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m];}); }

// auto-populate admin if logged in via local flag - (optional)
// You can set a simple "owner logged in" localStorage flag to avoid entering password every time (insecure)
if(localStorage.getItem("__zever_owner_logged") === "1"){
  showAdmin();
}

// expose showAdmin to console for quick access (dev)
window.__zever_showAdmin = showAdmin;

</script>
</body>
</html>
